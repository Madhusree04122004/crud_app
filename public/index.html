<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User CRUD App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
    }
    table {
      background-color: white;
    }
    th {
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="text-center my-4">User CRUD App</h1>

  <!-- Create User Form -->
  <h2>Create User</h2>
  <form id="createForm" class="mb-4">
    <input id="createName" class="form-control mb-2" placeholder="Name" required>
    <input id="createPassword" class="form-control mb-2" type="password" placeholder="Password" required>
    <input id="createAge" class="form-control mb-2" type="number" placeholder="Age" required>
    <input id="createDob" class="form-control mb-2" type="date" required>
    <input id="createDegree" class="form-control mb-2" placeholder="Degree" required>
    <button type="submit" class="btn btn-primary">Create</button>
  </form>

  <!-- Update User Form -->
  <h2>Update User</h2>
  <form id="updateForm" class="mb-4">
    <input id="updateId" class="form-control mb-2" placeholder="User ID" required>
    <input id="updateName" class="form-control mb-2" placeholder="New Name" required>
    <input id="updatePassword" class="form-control mb-2" type="password" placeholder="New Password" required>
    <input id="updateAge" class="form-control mb-2" type="number" placeholder="New Age" required>
    <input id="updateDob" class="form-control mb-2" type="date" required>
    <input id="updateDegree" class="form-control mb-2" placeholder="New Degree" required>
    <button type="submit" class="btn btn-warning">Update</button>
  </form>

  <!-- Delete User Form -->
  <h2>Delete User</h2>
  <form id="deleteForm" class="mb-4">
    <input id="deleteId" class="form-control mb-2" placeholder="User ID to delete" required>
    <button type="submit" class="btn btn-danger">Delete</button>
  </form>

  <!-- User Table -->
  <h2>All Users</h2>
  <button onclick="loadUsers()" class="btn btn-success mb-3">Load Users</button>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th onclick="sortTable(1)">Name ðŸ”½</th>
        <th onclick="sortTable(2)">Age ðŸ”½</th>
        <th onclick="sortTable(3)">DOB ðŸ”½</th>
        <th onclick="sortTable(4)">Degree ðŸ”½</th>
      </tr>
    </thead>
    <tbody id="userTableBody"></tbody>
  </table>

  <!-- Pagination Controls -->
  <div class="d-flex justify-content-between">
    <button id="prevPage" class="btn btn-secondary" disabled>Previous</button>
    <span id="pageInfo" class="align-self-center"></span>
    <button id="nextPage" class="btn btn-secondary" disabled>Next</button>
  </div>

</div>

<script>
  const apiUrl = '/users';
  let users = [];
  let currentPage = 1;
  const rowsPerPage = 2;

  async function loadUsers() {
    try {
      const res = await fetch(apiUrl);
      users = await res.json();
      currentPage = 1; 
      displayUsers();
    } catch (err) {
      console.error("Error loading users:", err);
    }
  }

  function displayUsers() {
    const tableBody = document.getElementById('userTableBody');
    tableBody.innerHTML = '';

    const start = (currentPage - 1) * rowsPerPage;
    const paginatedUsers = users.slice(start, start + rowsPerPage);

    paginatedUsers.forEach(user => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${user.id}</td>
        <td>${user.name}</td>
        <td>${user.age || 'N/A'}</td>
        <td>${user.dob || 'N/A'}</td>
        <td>${user.degree || 'N/A'}</td>
      `;
      tableBody.appendChild(row);
    });

    updatePagination();
  }

  function updatePagination() {
    const totalPages = Math.ceil(users.length / rowsPerPage);
    document.getElementById('pageInfo').innerText = `Page ${currentPage} of ${totalPages}`;
    document.getElementById('prevPage').disabled = currentPage === 1;
    document.getElementById('nextPage').disabled = currentPage === totalPages;
  }

  document.getElementById('prevPage').addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      displayUsers();
    }
  });

  document.getElementById('nextPage').addEventListener('click', () => {
    if (currentPage < Math.ceil(users.length / rowsPerPage)) {
      currentPage++;
      displayUsers();
    }
  });

  // Create user
  document.getElementById('createForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('createName').value;
    const password = document.getElementById('createPassword').value;
    const age = document.getElementById('createAge').value;
    const dob = document.getElementById('createDob').value;
    const degree = document.getElementById('createDegree').value;

    await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, password, age, dob, degree })
    });

    loadUsers();
  });

  // Update user
  document.getElementById('updateForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = document.getElementById('updateId').value;
    const name = document.getElementById('updateName').value;
    const password = document.getElementById('updatePassword').value;
    const age = document.getElementById('updateAge').value;
    const dob = document.getElementById('updateDob').value;
    const degree = document.getElementById('updateDegree').value;

    await fetch(`${apiUrl}/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, password, age, dob, degree })
    });

    loadUsers();
  });

  // Delete user
  document.getElementById('deleteForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = document.getElementById('deleteId').value;

    await fetch(`${apiUrl}/${id}`, {
      method: 'DELETE'
    });

    loadUsers();
  });

  window.onload = loadUsers;
</script>

</body>
</html>
